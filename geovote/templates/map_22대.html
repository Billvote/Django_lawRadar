<!DOCTYPE html>
<html lang="ko">
<head>
<<<<<<< HEAD
  <meta charset="UTF-8">
  <title>ëŒ€í•œë¯¼êµ­ ì„ ê±°êµ¬ ì§€ë„</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
    }
    .tooltip {
      position: absolute;
      background: white;
      border: 1px solid #999;
      padding: 6px 10px;
      font-size: 12px;
      pointer-events: none;
      border-radius: 4px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
      display: none;
    }
    #legend {
      margin-top: 10px;
    }
    #legend div {
      display: flex;
      align-items: center;
      font-size: 12px;
      margin-bottom: 4px;
    }
    #legend div span {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin-right: 5px;
=======
  <meta charset="UTF-8" />
  <title>22ëŒ€ ì§€ì—­êµ¬ ì§€ë„</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    #map {
      width: 800px;
      height: 600px;
      border: 1px solid #ccc;
      margin: 0 auto;
    }
    path {
      cursor: pointer;
>>>>>>> aa3b875dc212679e400c5dbae894a5e9ef435377
    }
  </style>
</head>
<body>
<<<<<<< HEAD
  <h2>ëŒ€í•œë¯¼êµ­ ì„ ê±°êµ¬ ì‹œê°í™”</h2>
  <svg width="800" height="1000"></svg>
  <div id="tooltip" class="tooltip"></div>
  <div id="legend"></div>

  <script>
    const svg = d3.select("svg");
    const tooltip = d3.select("#tooltip");
    const width = +svg.attr("width");
    const height = +svg.attr("height");

    const projection = d3.geoMercator()
      .center([127.8, 36.2])
      .scale(6000)
      .translate([width / 2, height / 2]);

    const path = d3.geoPath().projection(projection);

    // 1. ì •ë‹¹ ìƒ‰ìƒ ë§¤í•‘
    const partyColors = {
      "ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹": "#1f77b4",
      "êµ­ë¯¼ì˜í˜": "#d62728",
      "ì •ì˜ë‹¹": "#ffbb00",
      "ê¸°íƒ€": "#aaaaaa"
    };

    function getPartyColor(party) {
      return partyColors[party] || partyColors["ê¸°íƒ€"];
    }

    // 2. êµ­íšŒì˜ì› ì •ë³´ (ì˜ˆì‹œ)
    let memberInfo = {};
    d3.json("/static/js/memberInfo_22.json").then(data => {
      memberInfo = data;
      loadProvinces();
    });

    // 3. ì§€ë„ ë Œë”ë§
    function renderMap(geoData, level) {
      svg.selectAll("*").remove();

      svg.selectAll("path")
        .data(geoData.features)
        .join("path")
        .attr("d", path)
        .attr("fill", d => {
          if (level === "district") {
            const info = memberInfo[d.properties.district];
            return getPartyColor(info?.party);
          }
          return "#c5e1a5";
        })
        .attr("stroke", "#2e7d32")
        .on("mouseover", (event, d) => {
          if (level !== "district") return;
          const info = memberInfo[d.properties.district];
          tooltip
            .style("display", "block")
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 20) + "px")
            .html(`
              <strong>${d.properties.district}</strong><br/>
              ì˜ì›: ${info?.member || "ì •ë³´ ì—†ìŒ"}<br/>
              ì •ë‹¹: ${info?.party || "ì •ë³´ ì—†ìŒ"}
            `);
        })
        .on("mouseout", () => tooltip.style("display", "none"))
        .on("click", (event, d) => {
          if (level === "province") loadCities(d.properties.code);
          else if (level === "city") loadDistricts(d.properties.code);
        });

      svg.selectAll("text")
        .data(geoData.features)
        .join("text")
        .attr("x", d => path.centroid(d)[0])
        .attr("y", d => path.centroid(d)[1])
        .attr("text-anchor", "middle")
        .attr("font-size", "10px")
        .text(d => d.properties.name || d.properties.sggnm || d.properties.district);
    }

    // 4. ë‹¨ê³„ë³„ GeoJSON ë¶ˆëŸ¬ì˜¤ê¸°
    function loadProvinces() {
      d3.json("/static/js/22_ì‹œë„.json").then(data => {
        renderMap(data, "province");
      });
    }

    function loadCities(provinceCode) {
      d3.json(`/static/js/22_ì‹œêµ°êµ¬.json/${provinceCode}.geo.json`).then(data => {
        renderMap(data, "city");
      });
    }

    function loadDistricts(cityCode) {
      d3.json(`/static/js/22_pre.json/${cityCode}.geo.json`).then(data => {
        renderMap(data, "district");
      });
    }

    // 5. ë²”ë¡€ ë Œë”ë§
    const legend = d3.select("#legend");
    Object.entries(partyColors).forEach(([party, color]) => {
      legend.append("div")
        .html(`<span style="background:${color}"></span>${party}`);
    });
  </script>
</body>
</html>
=======
  <h2 style="text-align:center;">ğŸ—³ï¸ ì œ22ëŒ€ ì§€ì—­êµ¬ ì§€ë„</h2>
  <div id="map"></div>

  <script>
    const width = 800, height = 600;

    const svg = d3.select("#map")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    function partyColor(party) {
      const colors = {
        "ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹": "#1877f2",
        "êµ­ë¯¼ì˜í˜": "#e61e2b",
        "ì •ì˜ë‹¹": "#ffcb08",
        "ê¸°íƒ€": "#999"
      };
      return colors[party] || "#ccc";
    }

    d3.json("/api/districts/").then(data => {
    console.log("features ê°œìˆ˜:", data.features.length);

    svg.selectAll("path")
        .data(data.features)
        .enter()
        .append("path")
        .attr("d", path)
        .attr("fill", d => partyColor(d.properties.party))
        .attr("stroke", "#333")
        .attr("stroke-width", 0.5)
        .on("click", (event, d) => {
        const props = d.properties;
        alert(`${props.SIDO_SGG} - ${props.member_name}\n(${props.party})`);
        });
    }).catch(err => {
    console.error("GeoJSON ë¡œë”© ì‹¤íŒ¨:", err);
    });

  </script>
</body>
</html>
>>>>>>> aa3b875dc212679e400c5dbae894a5e9ef435377
