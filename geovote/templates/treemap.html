{% extends "base.html" %}
{% load static %}
{% block body %}

<!-- 상단 네비게이션 바 -->
 <nav class="bg-white shadow-sm border-b">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row items-center justify-between py-4 gap-4 md:gap-0">

      <!-- 좌측: 타이틀 + 설명 버튼 -->
      <div class="flex items-center text-2xl font-bold text-gray-800">
        🙋‍♂️우리 지역구 의원이 궁금해?🙋‍♀️
        <button class="explain-btn ml-3 text-sm flex items-center gap-1"
                data-title="📊 Treemap 페이지의 기능을 소개합니다!"
                data-content='
                  <div class="text-gray-700 text-[15px] font-medium leading-snug">
                    트리맵에서는 내가 뽑은 <span class="text-blue-600 font-semibold">우리 지역구 의원</span>이 어떤 주제에 <span class="text-blue-600 font-semibold">찬성, 반대, 기권</span> 표를 던졌는지 확인할 수 있어요!
                  </div>
                  <ul class="list-none pl-0 space-y-5">

                    <li class="flex items-start gap-2">
                      <div>
                        <p class="font-semibold text-gray-800">내가 살고 있는 지역을 찾아보세요!</p>
                        <p class="text-gray-700">
                          선거구가 많을수록 트리맵의 크기도 <span class="font-semibold text-blue-500">UP!</span>
                        </p>
                      </div>
                    </li>

                    <li class="flex items-start gap-2">
                      <span class="text-lg">🧑</span>
                      <div>
                        <p class="font-semibold text-gray-800">우리 지역의 의원 카드를 클릭해보세요!</p>
                        <p class="text-gray-700">해당 의원의 투표 정보를 확인할 수 있어요.</p>
                        <p class="text-gray-600 text-sm">우리 지역을 대표하는 의원은 어떤 법안에 관심이 많을까요?</p>
                      </div>
                    </li>

                    <li class="flex items-start gap-2">
                      <span class="text-lg">📅</span>
                      <div>
                        <p class="font-semibold text-gray-800">국회의 세 회기 (20·21·22대)만 제공돼요!</p>
                        <p class="text-gray-600 text-sm">
                          모든 의원이 모든 법안에 표결을 참여하진 않았을 수도 있어요.
                        </p>
                      </div>
                    </li>

                    <li class="flex items-start gap-2">
                      <span class="text-lg">❔</span>
                      <div>
                        <p class="font-semibold text-gray-800 mb-1">표결 정보는 이렇게 계산했어요!</p>
                        <ul class="list-disc list-inside text-gray-600 text-sm space-y-1">
                          <li>의원이 참여한 모든 표결을 클러스터(주제)별로 분류해 집계합니다.</li>
                          <li>찬성·반대 등에서 가장 두드러진 클러스터 1개씩을 대표로 보여드립니다.</li>
                          <li>각 클러스터에서 찬성·반대·기권·불참 수를 계산해 비율을 구합니다.</li>
                        </ul>
                      </div>
                    </li>
                    
                  </ul>
                '>
          <i class="fi fi-rr-info text-lg text-gray-700 hover:text-blue-800 transform transition-transform duration-200 hover:scale-125"></i>
        </button>
      </div>

      <!-- 우측: 대수 버튼 -->
      <div class="space-x-4">
        {% for age in ages %}
          <button
            class="age-btn text-lg font-semibold {% if selected_age == age.id %}text-cyan-500{% else %}text-gray-700{% endif %} hover:text-cyan-500"
            data-age="{{ age.id }}">
            {{ age.number }}대
          </button>
        {% endfor %}
      </div>
    </div>
  </div>
</nav>

<!-- 전체 화면 영역 -->
<div class="flex flex-col md:flex-row h-[calc(100vh-80px)]">
  <!-- 메인 영역 + 우측 패널을 flex로 묶음 -->
  <div class="flex flex-1 overflow-hidden">
    <!-- 메인: 트리맵 -->
    <main id="mainContent" class="flex-[1_1_0%] flex flex-col overflow-hidden p-4 bg-gray-50">
      <div class="border-b flex flex-col items-center md:flex-row md:justify-between gap-2 mb-2">
        <div>
          <h2 class="text-base text-gray-600 text-center mt-1 font-normal">
          🔍내가 뽑은 의원의 투표 정보를 찾아보세요!
        </h2>
        </div>
        
        <div id="breadcrumb" class="text-base text-gray-500"></div>
        <!-- 뒤로가기버튼 -->
        <span id="backButton"
              class="inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-full shadow-sm 
                    hover:bg-pink-50 hover:text-pink-600 transition-colors duration-300 cursor-pointer text-base font-medium">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
          </svg>
          이전
        </span>

      </div>
      <div id="treemap"  class="flex-1 overflow-auto h-full"></div>
    </main>

    <!-- 팝업(모달) 영역 -->
    <div id="popupModal" class="fixed inset-0 z-50 hidden flex items-center justify-center">
      <div class="absolute inset-0 bg-black/20 backdrop-blur-sm" id="popupOverlay"></div>
      <div class="relative bg-white rounded-xl shadow-xl w-full max-w-3xl max-h-[80vh] overflow-auto p-6">
        <button id="closeModalBtn" class="absolute top-4 right-4 z-10 bg-white rounded-full text-2xl font-bold px-3 py-1 shadow">
          &times;
        </button>
        <div class="flex items-center mb-4">
          <h2 id="modalTitle" class="font-bold text-xl text-gray-900 whitespace-nowrap"></h2>
          <div id="modalVoteCount" class="text-base text-gray-500 ml-3 whitespace-nowrap"></div>
        </div>
        <div id="modalContent" class="text-sm"></div>
      </div>
    </div>

{% endblock %}

{% block script %}
<script src="https://d3js.org/d3.v6.min.js"></script>

<script src="{% static 'js/treemap.js' %}"></script>
{% endblock %}
