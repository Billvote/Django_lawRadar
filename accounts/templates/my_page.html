{% extends "base.html" %}
{% load custom_filters %}
{% load static %}
{% block body %}

<h2 class="text-xl font-bold mb-8">ê´€ì‹¬ ë²•ì•ˆë“¤</h2>

<!-- ë‚´ê°€ ì¢‹ì•„ìš”í•œ ë²•ì•ˆ í´ëŸ¬ìŠ¤í„° ë¶„ì„ ì¹´ë“œ -->
<section class="my-8 max-w-4xl mx-auto p-4 bg-white rounded-xl shadow border border-gray-200">
  <h3 class="text-lg font-bold mb-4">ğŸ§  ê´€ì‹¬ ë²•ì•ˆ í´ëŸ¬ìŠ¤í„° ë¶„ì„</h3>
  
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    {% for cluster, count in cluster_counts.items %}
      <div class="p-4 border rounded-md">
        <h4 class="font-semibold">í´ëŸ¬ìŠ¤í„° {{ cluster }} ({{ count }}ê±´)</h4>
        <p class="text-gray-600 text-sm mt-1">ì£¼ìš” í‚¤ì›Œë“œ: <strong>{{ cluster_keywords|dict_get:cluster }}</strong></p>
      </div>
    {% empty %}
      <p>ì•„ì§ ê´€ì‹¬ ë²•ì•ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endfor %}
  </div>
</section>


<section>
  <div class="w-full max-w-[640px] mx-auto px-4">
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
      <div style="background:#38bdf8;" class="p-4 rounded-md">
        <h2 class="text-xl font-bold text-white">â¤ï¸ ê´€ì‹¬ ìˆëŠ” ë²•ì•ˆ ë¦¬ìŠ¤íŠ¸</h2>
        <p class="text-cyan-100 text-sm mt-1">ê´€ì‹¬ ìˆê²Œ ë³¸ ë²•ì•ˆ ë¦¬ìŠ¤íŠ¸</p>
      </div>

      <div class="p-6">
        <div class="space-y-4">
          {% for bill in liked_bills %}
          <div class="relative group bill-card border-b border-gray-100 pb-4 last:border-b-0 last:pb-0 p-3 rounded-lg cursor-pointer
                      hover:bg-gray-50 hover:-translate-y-[2px] hover:shadow-lg transition-all duration-200"
               onclick="location.href='{% url 'history:bill_detail' bill.pk %}'">

            <!-- ì¢‹ì•„ìš” ë²„íŠ¼ (í•­ìƒ ë³´ì´ê²Œ) -->
            {% if user.is_authenticated %}
            <button type="button"
                    class="like-btn text-2xl absolute top-4 right-4 z-10"
                    data-bill-id="{{ bill.id }}"
                    data-csrf-token="{{ csrf_token }}"
                    onclick="event.stopPropagation();">
              {% if bill.id in liked_ids %}â¤ï¸{% else %}ğŸ¤{% endif %}
            </button>
            {% endif %}

            <!-- ì œëª© -->
            <h3 class="font-semibold text-gray-900 mb-2 line-clamp-2 transition-colors duration-200 group-hover:text-cyan-600">
              {{ bill.title }}
            </h3>

            <!-- ë©”íƒ€ ì •ë³´ -->
            <div class="flex flex-wrap items-center text-sm text-gray-600 font-semibold gap-x-4">
              <div class="flex items-center gap-x-1">
                <span>ğŸ“ƒ</span>
                <span>{{ bill.bill_number }}</span>
              </div>
              <div class="flex items-center gap-x-1">
                <span>ğŸ“…</span>
                <span>{{ bill.latest_vote_date|default:"-"|date:"Y-m-d" }}</span>
              </div>
            </div>

          </div>
          {% empty %}
          <p>ì•„ì§ ì¢‹ì•„ìš”í•œ ë²•ì•ˆì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜¢</p>
          <a href="{% url 'cardnews:home' %}" class="inline-block mt-4 px-4 py-2 bg-cyan-100 rounded hover:bg-cyan-200 transition">
            ê´€ì‹¬ ë²•ì•ˆ ë‘˜ëŸ¬ë³´ê¸°
          </a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

<!-- í˜ì´ì§• -->
<div class="pagination mt-12 mb-12 flex justify-center">
  <nav class="flex items-center space-x-2">
    
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}"
         class="px-4 py-2 rounded hover:bg-gray-50 transition-colors duration-300 flex items-center">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        ì´ì „
      </a>
    {% else %}
      <span class="px-4 py-2 text-gray-400 flex items-center">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        ì´ì „
      </span>
    {% endif %}

    {% for num in page_range %}
      {% if num == page_obj.number %}
        <span class="px-4 py-2 bg-cyan-400 text-white rounded font-semibold">{{ num }}</span>
      {% else %}
        <a href="?page={{ num }}"
           class="px-4 py-2 rounded hover:bg-gray-200 transition-colors duration-300">{{ num }}</a>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}"
         class="px-4 py-2 rounded hover:bg-gray-50 transition-colors duration-300 flex items-center">
        ë‹¤ìŒ
        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </a>
    {% else %}
      <span class="px-4 py-2 text-gray-400 flex items-center">
        ë‹¤ìŒ
        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </span>
    {% endif %}
  </nav>
</div>


</section>

{% endblock %}



{% block script%}
<script>
    
// ì¢‹ì•„ìš” ê¸°ëŠ¥
document.querySelectorAll('.like-btn').forEach(btn => {
  btn.addEventListener('click', function(e) {
    e.preventDefault();
    const billId = this.dataset.billId;
    fetch("{% url 'cardnews:toggle_like' 0 %}".replace('0', billId), {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'Content-Type': 'application/json',
      },
      credentials: 'same-origin',
    }).then(res => res.json())
      .then(data => {
        this.textContent = data.liked ? 'â¤ï¸' : 'ğŸ¤';
      });
  });
});
</script>
{% endblock %}