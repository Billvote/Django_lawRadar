<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>키워드 은하계</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: white;
      color: white;
      margin: 0;
    }
    .home-tooltip {
      position: absolute;
      background-color: #fff;
      color: #000;
      padding: 8px;
      border-radius: 4px;
      pointer-events: none;
      font-size: 14px;
      box-shadow: 0 0 5px rgba(0,0,0,0.5);
      display: none;
    }
  </style>
</head>
<body>
  <svg id="galaxy" width="100%" height="1000">
    <defs>
      <filter id="glow">
        <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
        <feMerge>
          <feMergeNode in="coloredBlur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
  </svg>
  <div id="tooltip" class="home-tooltip"></div>

  <script>
    const width = window.innerWidth;
    const height = 1000;
    const svg = d3.select("#galaxy")
                  .attr("width", width)
                  .attr("height", height);

    const tooltip = d3.select("#tooltip");

    d3.json("/api/cluster_keywords/").then(data => {
      const simulation = d3.forceSimulation(data)
        .force("charge", d3.forceManyBody().strength(-50))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("collision", d3.forceCollide().radius(d => Math.sqrt(d.num_bills) * 4 + 10))
        .on("tick", ticked);
        console.log("노드 개수:", data.length);

      const node = svg.selectAll("circle")
        .data(data)
        .enter().append("circle")
        .attr("r", d => Math.sqrt(d.num_bills) * 4)
        .attr("fill", d => d3.interpolateCool(Math.random()))
        .attr("filter", "url(#glow)")  // ✨ glow 필터 추가
        .attr("stroke", "#fff")
        .attr("stroke-width", 1)
        .on("mouseover", function(event, d) {
          tooltip.style("display", "block")
                 .html(`<strong>#${d.keyword}</strong><br>법안 ${d.num_bills}건`)
                 .style("left", (event.pageX + 10) + "px")
                 .style("top", (event.pageY - 20) + "px");
        })
        .on("mousemove", function(event) {
          tooltip.style("left", (event.pageX + 10) + "px")
                 .style("top", (event.pageY - 20) + "px");
        })
        .on("mouseout", function() {
          tooltip.style("display", "none");
        })
        .on("click", function(event, d) {
          window.location.href = d.url;  // ✅ URL로 이동
        });

      function ticked() {
        node.attr("cx", d => d.x)
            .attr("cy", d => d.y);
      }
    });
  </script>
</body>
</html>
