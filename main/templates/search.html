{% extends "base.html" %}
{% load main_custom_filters %}  {# í•„ìš”í•˜ë©´ ìœ ì§€í•˜ì„¸ìš” #}

{% block body %}
        <!-- Left: Keywords and Info -->
<div class="space-y-6">
  <!-- Breadcrumb -->
  <nav class="flex items-center space-x-2 text-sm text-black">
    <a href="{% url 'home' %}" class="hover:text-gray transition-colors">home</a>
    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
    </svg>
    <span class="text-black font-semi">í‚¤ì›Œë“œ ê²€ìƒ‰</span>
  </nav>

  <!-- Keywords Title -->
  <div class="space-y-4 mb-6">
    <h1 class="flex flex-wrap gap-2 text-4xl md:text-6xl font-black leading-tight"
        style="font-family: 'TmoneyRoundWindExtraBold', sans-serif;">
        <span class="bg-gradient-to-r from-emerald-400 to-lime-500 bg-clip-text text-transparent">
          #{{ query }}
        </span>
    </h1>
    {% if total_results_count > 0 %}
      <p class="text-gray-600 mb-8">ğŸ‘â€‹{{ total_results_count }}ê°œì˜ ì˜ì•ˆì„ ì°¾ì•˜ìŠµë‹ˆë‹¤</p>
    {% else %}
      <p class="text-gray-600 mb-8">ğŸ˜¥ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”</p>
    {% endif %}
  </div>

<!-- í•´ì‹œíƒœê·¸ -->
<!-- <div class="p-6 max-w-6xl mx-auto">
    <div class="flex flex-wrap gap-2 mb-8">
      {% for cluster in top_clusters %}
        {% for kw in cluster.keywords %}
          <a href="{% url 'cardnews:card' cluster.cluster_id %}" class="inline-block mb-2">
            <span class="hashtag inline-block bg-gray-200 text-gray-600 text-sm font-medium px-3 py-1 rounded-full">
              #{{ kw }}
            </span>
          </a>
        {% endfor %}
      {% endfor %}
    </div>
</div> -->

{% if page_obj %}
<!-- ì¹´ë“œ ê·¸ë¦¬ë“œ -->
<div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 max-w-none mx-auto px-6 mb-12">
  {% for bill in page_obj %}
  <div class="flex flex-col h-full bg-white backdrop-blur-sm rounded-2xl shadow hover:shadow-2xl transition-all duration-500 overflow-hidden hover:border-blue-200 group">
    <!-- ì¹´ë“œ í—¤ë” -->
    <div class="bg-white p-3 border-b border-gray-100">
      <div class="flex items-start justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-10 text-cyan-600 rounded-lg flex items-center justify-center font-bold">
            {{ bill.age }}
          </div>
        </div>
        {% if bill.label_count %}
        <div class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm font-semibold">
          ê°œì • {{ bill.label_count }}íšŒ
        </div>
        {% endif %}
      </div>
    </div>

    <!-- ì¹´ë“œ ë³¸ë¬¸ -->
    <div class="p-6 flex-1 flex flex-col justify-between text-center">
      <h3 style="font-size: 16px;" class="font-bold text-gray-900 mb-4 group-hover:text-cyan-600 transition-colors duration-300 line-clamp-2">
        <a href="{% url 'history:bill_detail' bill.pk %}?page={{ page_obj.number }}">
          {{ bill.title_custom|safe|default:bill.title }}
        </a>
      </h3>

      <!-- í‚¤ì›Œë“œ -->
      <div class="mb-6">
        {% with cluster_keywords_dict|get_item:bill.cluster as kw_str %}
          {% if kw_str %}
            <div class="flex flex-wrap gap-2 justify-center">
              {% for kw in kw_str|split_by_comma|slice:":3" %}
                <a href="{% url 'cardnews:card' bill.cluster %}" class="inline-block">
                  <span class="hashtag inline-block text-xs font-medium px-3 py-1 rounded-full transition-all duration-300 hover:scale-105"
                        style="background-color: {{ cluster_color_map|get_item:bill.cluster }}; color:#fff;">
                    #{{ kw }}
                  </span>
                </a>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
      </div>

      <!-- ì¹´ë“œ í‘¸í„° -->
      <div class="mt-6 pt-3 border-t border-gray-100 flex items-center justify-between text-sm text-gray-500">
        <div class="text-sm text-gray-500">ì˜ì•ˆë²ˆí˜¸: {{ bill.bill_number }}</div>
            <!-- <div class="font-semibold text-gray-900">{{ bill.bill_number }}</div> -->
        <div class="text-sm text-gray-500">ìµœê·¼ í‘œê²°: {{ bill.last_vote_date|default:"-"|date:"Y-m-d" }}</div>
      </div>
    </div>
  </div>
  {% empty %}
  <div class="col-span-full text-center py-20 text-gray-500 text-lg">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
  {% endfor %}
</div>

<!-- í˜ì´ì§• -->
<div class="pagination m-4 flex justify-center space-x-2">
  {% if page_obj.has_previous %}
    <a href="?q={{ query }}&page={{ page_obj.previous_page_number }}" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">ì´ì „</a>
  {% else %}
    <span class="px-3 py-1 text-gray-400">ì´ì „</span>
  {% endif %}

  {% for num in page_range %}
    {% if num == page_obj.number %}
      <span class="px-3 py-1 rounded bg-cyan-500 text-white">{{ num }}</span>
    {% else %}
      <a href="?q={{ query }}&page={{ num }}" class="px-3 py-1 rounded hover:bg-gray-200">{{ num }}</a>
    {% endif %}
  {% endfor %}

  {% if page_obj.has_next %}
    <a href="?q={{ query }}&page={{ page_obj.next_page_number }}" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">ë‹¤ìŒ</a>
  {% else %}
    <span class="px-3 py-1 text-gray-400">ë‹¤ìŒ</span>
  {% endif %}
</div>
{% endif %}
{% endblock %}

{% block script %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const hashtags = document.querySelectorAll('.hashtag');

    hashtags.forEach(tag => {
      const originalBg = tag.style.backgroundColor;
      const originalColor = window.getComputedStyle(tag).color;

      tag.addEventListener('mouseenter', () => {
        tag.style.backgroundColor = '#eeeeee';
        tag.style.setProperty('color', '#4B5563', 'important');
      });
      tag.addEventListener('mouseleave', () => {
        tag.style.backgroundColor = originalBg;
        tag.style.color = originalColor;
        tag.style.setProperty('color', originalColor, 'important');
      });
    });
  });
</script>

<style>
/* ì¤„ì„ í…ìŠ¤íŠ¸ */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.grid > div {
  animation: fadeInUp 0.6s ease-out forwards;
}

.grid > div:nth-child(2) { animation-delay: 0.1s; }
.grid > div:nth-child(3) { animation-delay: 0.2s; }
.grid > div:nth-child(4) { animation-delay: 0.3s; }
.grid > div:nth-child(5) { animation-delay: 0.4s; }
.grid > div:nth-child(6) { animation-delay: 0.5s; }

/* í•´ì‹œíƒœê·¸ í˜¸ë²„ íš¨ê³¼ */
.hashtag:hover {
  background: #e5e7eb !important;
  color: #374151 !important;
  transform: scale(1.05);
}

/* ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
html {
  scroll-behavior: smooth;
}
</style>
{% endblock %}
