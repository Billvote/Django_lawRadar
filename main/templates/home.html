{% extends "base.html" %}
{% load static %}

{% block body %}
<style>
  /* â”€â”€ ë°°ê²½/ì „ì—­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #galaxy{position:fixed;top:0;left:0;z-index:0;width:100%;height:100vh;pointer-events:none;}
  #galaxy circle{pointer-events:auto;}
  .home-overlay{position:relative;z-index:10;text-align:center;padding-top:10vh;color:#111827;}
  .home-tooltip{position:absolute;display:none;padding:6px 10px;background:rgba(0,0,0,.75);color:#fff;
                border-radius:6px;font-size:14px;pointer-events:none;z-index:20;}
  @keyframes twinkle{0%,100%{filter:brightness(1);}50%{filter:brightness(1.5);}}
  circle.twinkle{animation:twinkle 2s infinite ease-in-out;}
  circle{shape-rendering:geometricPrecision;}
</style>

<!-- â”€â”€ SVG ê°¤ëŸ­ì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<svg id="galaxy">
  <defs>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
      <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  </defs>
</svg>
<div id="tooltip" class="home-tooltip"></div>
<!-- â”€â”€ ì½˜í…ì¸  ë°•ìŠ¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="home-content"
     class="home-overlay px-6 max-w-3xl mx-auto relative text-gray-800"
     style="backdrop-filter:blur(8px);background:rgba(255,255,255,.75);
            border-radius:12px;padding:3rem 2rem;opacity:0;transition:opacity 1s;">

  <div class="inline-flex items-end gap-3 mb-4" style="margin: 0 auto; width: max-content;">
    <h1 class="text-5xl font-extrabold relative" style="left: 40px;">Law Radar</h1>
    <button class="explain-btn text-sm flex items-center gap-1"
            style="margin-left: 50px;"
            data-title="ğŸ…í™ˆ í™”ë©´ì˜ ê¸°ëŠ¥ì„ ì†Œê°œí•©ë‹ˆë‹¤!"
            data-content='
            <ul class="list-disc pl-5 mt-2 text-sm space-y-3">
              <li>
                ê¶ê¸ˆí•œ í‚¤ì›Œë“œê°€ ìˆë‹¤ë©´ <span class="font-semibold text-blue-600">ì§ì ‘ ê²€ìƒ‰</span>í•´ë³´ì„¸ìš”!<br>
                <span class="text-gray-500 text-xs">
                  ì˜ˆ: "ê¸°í›„ë³€í™”", "ì²­ë…„", "ë¶€ë™ì‚°" ë“±ì˜ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”.
                </span>
              </li>
              <li>
                í‚¤ì›Œë“œë¥¼ ëª¨ë¥´ê² ë‹¤ë©´ <span class="font-semibold text-blue-600">ì </span>ë“¤ì„ í´ë¦­í•´ë³´ì„¸ìš”!<br>
                <span class="text-gray-500 text-xs">
                  ì  í¬ê¸°ëŠ” ë²•ì•ˆ ìˆ˜ì— ë¹„ë¡€í•˜ë©°, í´ë¦­í•˜ë©´ ì¹´ë“œë‰´ìŠ¤ë¡œ ì´ë™í•©ë‹ˆë‹¤.
                </span>
              </li>
            </ul>

            '>
      <i class="fi fi-rr-info text-lg text-blue-600 hover:text-blue-800 transform transition-transform duration-200 hover:scale-125"></i>
    </button>
  </div>

  <p class="text-lg leading-relaxed mb-8">
    êµ­íšŒì˜ í‘œê²°ì€ ìš°ë¦¬ì˜ ì‚¶ê³¼ ì§ê²°ë©ë‹ˆë‹¤<br>
    ê° ì •ë‹¹ì€ ì–´ë–¤ ë²•ì•ˆì— ì°¬ì„±í•˜ê³ , ì§€ì—­êµ¬ êµ­íšŒì˜ì›ë“¤ì€ ì–´ë–¤ ì£¼ì œì— ì§‘ì¤‘í•˜ê³  ìˆì„ê¹Œìš”?<br>
    ì •ë‹¹ë³„Â·ì§€ì—­ë³„ í‘œê²° í˜„í™©ê³¼ ê´€ì‹¬ í‚¤ì›Œë“œë¥¼ í•œëˆˆì— ì‚´í´ë³´ì„¸ìš”.<br>
  </p>
  <br>
  <p class="text-sm mb-12 opacity-75 text-gray-900">
    ì  ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ê°€ê¹Œì´ ëŒ€ë³´ì„¸ìš”<br>
    ì ì„ í´ë¦­í•˜ë©´ ë‹¤ì–‘í•œ ë²•ì•ˆ ì£¼ì œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
  </p>

  <!-- â”€â”€ ê²€ìƒ‰ì°½ + ìë™ì™„ì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
   <div class="max-w-xl mx-auto">
    <form method="GET" action="{% url 'search' %}" class="relative">
      <input id="search-input" name="q" type="text"
             placeholder="ë²•ì•ˆëª…ì´ë‚˜ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”"
             class="w-full text-lg font-medium rounded-3xl border border-gray-300
                    px-4 py-2 focus:outline-none focus:ring-1 focus:ring-cyan-400 transition"/>
      <!-- ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ -->
      <ul id="ac-box"
          class="absolute left-0 top-full mt-1 w-full bg-white border border-gray-300
                 rounded-md shadow-lg z-50 hidden text-left"></ul>
      <!-- ì œì¶œ ë²„íŠ¼ -->
      <button type="submit"
              class="absolute right-3 top-1/2 -translate-y-1/2 text-cyan-500 font-semibold rounded-lg">
        ê²€ìƒ‰
      </button>
    </form>
  </div>
</div>
{% endblock %}

{% block script %}
<!-- â”€â”€ D3 ê°¤ëŸ­ì‹œ ìŠ¤í¬ë¦½íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
const width  = window.innerWidth;
const height = 1000;
const svg    = d3.select("#galaxy").attr("width", width).attr("height", height);
const tooltip= d3.select("#tooltip");

d3.json("/api/cluster_keywords/").then(data => {
  const simulation = d3.forceSimulation(data)
        .force("charge", d3.forceManyBody().strength(-50))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("collision", d3.forceCollide().radius(d => Math.sqrt(d.num_bills) * 4 + 10))
        .on("tick", ticked);

  const node = svg.selectAll("circle")
      .data(data)
      .enter().append("circle")
      .attr("r", d => Math.sqrt(d.num_bills) * 3)
      .attr("fill", () => d3.interpolateCool(Math.random()))
      .attr("filter", "url(#glow)")
      .on("mouseover", function (event, d) {
          d._r = Math.sqrt(d.num_bills) * 3;
          tooltip.style("display", "block")
                 .html(`<strong>#${d.keyword}</strong><br>ë²•ì•ˆ ${d.num_bills}ê±´`)
                 .style("left", (event.pageX + 10) + "px")
                 .style("top",  (event.pageY - 20) + "px");
          d3.select(this).transition().duration(200).attr("r", d._r * 1.5);
      })
      .on("mousemove", event => {
          tooltip.style("left", (event.pageX + 10) + "px")
                 .style("top",  (event.pageY - 20) + "px");
      })
      .on("mouseout", function (event, d) {
          tooltip.style("display", "none");
          d3.select(this).transition().duration(200).attr("r", d._r);
      })
      .on("click", (event, d) => window.location.href = d.url);

  node.transition().duration(1500)
      .attr("r", d => Math.sqrt(d.num_bills) * 4.3)
      .attr("opacity", 1)
      .on("end", (d, i, nodes) => {
        if (i === nodes.length - 1) {
          d3.select("#home-content").style("opacity", 1);
        }
      });

  function ticked() {
    node.attr("cx", d => d.x).attr("cy", d => d.y);
  }
});
</script>

<!-- íŒì—…(ëª¨ë‹¬) ì˜ì—­ ------------------------------------------------------------------------------>
 <div id="popupModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
  <div id="popupOverlay" class="absolute inset-0 bg-black opacity-50"></div>
  <div class="relative bg-white rounded-lg shadow-lg max-w-md w-full p-6 z-10">
    <h2 id="modalTitle" class="text-xl font-bold mb-4"></h2>
    <div id="modalContent" class="text-gray-700">ëª¨ë‹¬ ì½˜í…ì¸ </div>
    <div class="mt-6 text-right">
      <button id="closeModalBtn" class="absolute top-4 right-4 z-10 bg-white rounded-full text-2xl font-bold px-3 py-1 shadow">
      &times;
      </button>
    </div>
  </div>
</div>

<script>
  const popupModal = document.getElementById("popupModal");
  const popupOverlay = document.getElementById("popupOverlay");
  const closeModalBtn = document.getElementById("closeModalBtn");
  const modalTitle = document.getElementById("modalTitle");
  const modalContent = document.getElementById("modalContent");
  const mainContent = document.getElementById("home-content");


// íŒì—… ì—´ê¸°
  function openPopup(title, contentHtml) {
    modalTitle.textContent = title;
    modalContent.innerHTML = contentHtml;
    popupModal.classList.remove("hidden");
    mainContent.classList.add("opacity-70", "blur-sm");
  }

  // íŒì—… ë‹«ê¸°
  function closePopup() {
    popupModal.classList.add("hidden");
    mainContent.classList.remove("opacity-70", "blur-sm");
  }

  // ë‹«ê¸°/ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ íŒì—… ë‹«ê¸°
  closeModalBtn.addEventListener("click", closePopup);
  popupOverlay.addEventListener("click", closePopup);

  // explain-btn í´ë¦­ ì‹œ íŒì—… ì—´ê¸° ì´ë²¤íŠ¸ ì—°ê²°
  document.querySelectorAll(".explain-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const title = btn.dataset.title;
    const content = btn.dataset.content;
    openPopup(title, content);
  });
});
  
</script>

<!-- â”€â”€ ì»¤ìŠ¤í…€ ìë™ì™„ì„± ìŠ¤í¬ë¦½íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const inp = document.getElementById("search-input");
  const box = document.getElementById("ac-box");
  let selected = -1;

  /* ê²°ê³¼ í‘œì‹œ */
  function render(list) {
    box.innerHTML = "";
    selected = -1;
    if (!list.length) { box.classList.add("hidden"); return; }
    list.forEach((txt, idx) => {
      const li = document.createElement("li");
      li.textContent = txt;
      li.className = "px-4 py-2 cursor-pointer hover:bg-gray-100 text-left";
      li.addEventListener("mousedown", () => {
        inp.value = txt;
        box.classList.add("hidden");
      });
      box.appendChild(li);
    });
    box.classList.remove("hidden");
  }

  /* ì„ íƒ í•˜ì´ë¼ì´íŠ¸ */
  function highlight() {
    [...box.children].forEach((li, i) =>
      li.classList.toggle("bg-cyan-100", i === selected));
  }

  /* ì…ë ¥ ê°ì§€ */
  inp.addEventListener("input", () => {
    const term = inp.value.trim();
    if (term.length < 2) { render([]); return; }
    fetch(`/api/autocomplete/?term=${encodeURIComponent(term)}`)
      .then(r => r.json())
      .then(render)
      .catch(err => console.error("Autocomplete error:", err));
  });

  /* í™”ì‚´í‘œ/ì—”í„° ì²˜ë¦¬ */
  inp.addEventListener("keydown", e => {
    const cnt = box.children.length;
    if (!cnt) return;
    if (e.key === "ArrowDown") {
      e.preventDefault();
      selected = (selected + 1) % cnt;
      highlight();
    } else if (e.key === "ArrowUp") {
      e.preventDefault();
      selected = (selected - 1 + cnt) % cnt;
      highlight();
    } else if (e.key === "Enter" && selected > -1) {
      e.preventDefault();
      inp.value = box.children[selected].textContent;
      box.classList.add("hidden");
      inp.form.submit();
    }
  });

  /* ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸° */
  document.addEventListener("click", e => {
    if (!inp.contains(e.target) && !box.contains(e.target)) {
      box.classList.add("hidden");
    }
  });
});
</script>
{% endblock %}
