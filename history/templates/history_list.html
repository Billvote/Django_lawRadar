{# history/templates/history_list.html â€” ì¹´ë“œ ì „ì²´ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ (í•´ì‹œíƒœê·¸ ì œì™¸) #}
{% extends "base.html" %}
{% load history_filters %}

{% block body %}
<!-- Hero Section -->
<!-- <div class="relative overflow-hidden bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 py-20"> -->
  <!-- Background Effects -->
  <!-- <div class="absolute inset-0">
    <div class="absolute top-10 right-10 w-40 h-40 bg-blue-500/20 rounded-full blur-2xl animate-pulse"></div>
    <div class="absolute bottom-10 left-10 w-32 h-32 bg-purple-500/20 rounded-full blur-xl animate-pulse delay-1000"></div>
  </div> -->
  
  <div class="relative z-10 max-w-6xl mx-auto px-6 text-center">
    <h1 class="text-4xl md:text-6xl font-black text-white mb-6">
      {% if query %}
        "<span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-pink-400">{{ query }}</span>" ê²€ìƒ‰ê²°ê³¼
      {% else %}
        ğŸ“‹ <span class="text-black">ë²•ì•ˆ ëª©ë¡</span>
      {% endif %}
    </h1>
    <p class="text-xl md:text-2xl text-black/90 font-medium max-w-3xl mx-auto">
      ì£¼ìš” ë²•ì•ˆë“¤ì„ í•œëˆˆì— í™•ì¸í•˜ê³  ê°œì • ë‚´ìš©ì„ íƒìƒ‰í•˜ì„¸ìš”!
    </p>
  </div>
</div>

<!-- Main Content -->
<div class="bg-50 min-h-screen">
  <div class="max-w-7xl mx-auto px-6 py-12">
    
    <!-- Search and Filter Section -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-12 border border-gray-100">
      <div class="flex flex-col lg:flex-row gap-6 items-center">
        <!-- Search Form -->
        <div class="flex-1 w-full">
          <form action="{% url 'search' %}" method="get">
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
              </div>
              <input type="text" name="q" id="id_keyword"
                     value="{{ query }}" placeholder="ë²•ì•ˆëª…, í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•˜ì„¸ìš”..."
                     class="w-full pl-12 pr-32 py-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg transition-all duration-300">
              {% if selected_cluster %}
                <input type="hidden" name="cluster" value="{{ selected_cluster }}">
              {% endif %}
              <button type="submit"
                      class="absolute right-2 top-1/2 -translate-y-1/2 px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 font-semibold">
                ê²€ìƒ‰
              </button>
            </div>
          </form>
        </div>
        
        <!-- Stats -->
        <div class="flex gap-8 text-center">
          <div>
            <div class="text-2xl font-bold text-gray-900">{{ total_results_count }}</div>
            <div class="text-sm text-gray-600">ì´ ë²•ì•ˆ</div>
          </div>
          <div>
            <div class="text-2xl font-bold text-gray-900">{{ total_cluster_count }}</div>
            <div class="text-sm text-gray-600">ì£¼ì œ</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Section -->
    {% if not total_results_count and query %}
      <!-- No Results -->
      <div class="text-center py-20">
        <div class="w-24 h-24 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
          <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.084-2.329"/>
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-600 mb-6">ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ë‹¤ì‹œ ê²€ìƒ‰í•´ë³´ì„¸ìš”</p>
        <a href="{% url 'history:history_list' %}" 
           class="inline-flex items-center px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-300">
          ì „ì²´ ëª©ë¡ ë³´ê¸°
        </a>
      </div>
    {% else %}
      <!-- Bill Cards Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8">
        {% for bill in page_obj.object_list %}
        <div class="bill-card bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 overflow-hidden border border-gray-100 hover:border-blue-200 group cursor-pointer"
             data-href="{% url 'history:bill_detail' bill.pk %}?page={{ page_obj.number }}">
          <!-- ìˆ˜ì •ëœ ì¹´ë“œ í—¤ë” -->
          <div class="bg-white p-3 border-b border-gray-100">
            <div class="flex items-start justify-between">
              <div class="flex items-center space-x-3">
                <div class="w-10 text-cyan-600 rounded-lg flex items-center justify-center font-bold">
                  {{ bill.age }}
                </div>
                <!-- <div>
                  <div class="text-sm text-gray-500">ì˜ì•ˆë²ˆí˜¸</div>
                  <div class="font-semibold text-gray-900">{{ bill.bill_number }}</div>
                </div> -->
              </div>
              {% if bill.related_count %}
              <div class="text-gray-800 px-3 py-1 rounded-full text-sm font-semibold flex items-center">
                <svg class="w-4 h-4 mr-2 text-cyan-500" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                </svg>
                ê°œì • {{ bill.related_count }}íšŒ
              </div>
              {% endif %}
            </div>
          </div>     
          
          <!-- ê¸°ì¡´ ì¹´ë“œ í—¤ë” -->
          <!-- <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-6 border-b border-gray-100">
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-blue-500 text-white rounded-lg flex items-center justify-center font-bold">
                  {{ bill.age }}
                </div>
                <div>
                  <div class="text-sm text-gray-500">ì˜ì•ˆë²ˆí˜¸</div>
                  <div class="font-semibold text-gray-900">{{ bill.bill_number }}</div>
                </div>
              </div>
              {% if bill.related_count %}
              <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                ê°œì • {{ bill.related_count }}íšŒ
              </div>
              {% endif %}
            </div>
          </div> -->
          
          <!-- Card Content -->
          <div class="p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4 line-clamp-2 group-hover:text-cyan-600 transition-colors duration-300">
              <a href="{% url 'history:bill_detail' bill.pk %}?page={{ page_obj.number }}">
                {{ bill.title_custom|safe|default:bill.title }}
              </a>
            </h3>
            
            <!-- Keywords -->
            <div class="mb-6">
              {% with cluster_keywords_dict|get_item:bill.cluster as kw_str %}
                {% if kw_str %}
                  <div class="flex flex-wrap gap-2">
                    {% for kw in kw_str|split_by_comma|slice:":3" %}
                      <a href="{% url 'cardnews:card' bill.cluster %}" class="inline-block">
                        <span class="hashtag inline-block text-xs font-medium px-3 py-1 rounded-full transition-all duration-300 hover:scale-105"
                              style="background-color: {{ cluster_color_map|get_item:bill.cluster }}; color:#fff;">
                          #{{ kw }}
                        </span>
                      </a>
                    {% endfor %}
                  </div>
                {% endif %}
              {% endwith %}
            </div>
            
            <!-- Card Footer -->
            <div class="flex items-center justify-between">
              <div class="text-sm text-gray-500"></div>
              <!-- ì•„ì´ì½˜ ì œê±° ë˜ëŠ” í•„ìš”ì‹œ ì¶”ê°€ -->
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-span-full text-center py-20">
          <div class="text-gray-500 text-lg">í‘œì‹œí•  ë²•ì•ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
        {% endfor %}
      </div>

      <!-- Enhanced Pagination -->
      {% if page_obj.has_other_pages %}
      <div class="mt-16 flex justify-center">
        <nav class="flex items-center space-x-2">
          {% if page_obj.has_previous %}
            <a href="?{% if query %}keyword={{ query|urlencode }}&{% endif %}{% if selected_cluster %}cluster={{ selected_cluster }}&{% endif %}page={{ page_obj.previous_page_number }}"
               class="px-4 py-2 rounded hover:bg-gray-50 transition-colors duration-300 flex items-center">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
              ì´ì „
            </a>
          {% endif %}

          {% for num in page_range %}
            {% if num == page_obj.number %}
              <span class="px-4 py-2 bg-cyan-400 text-white rounded-lg font-semibold">{{ num }}</span>
            {% else %}
              <a href="?{% if query %}keyword={{ query|urlencode }}&{% endif %}{% if selected_cluster %}cluster={{ selected_cluster }}&{% endif %}page={{ num }}"
                 class="px-4 py-2 rounded hover:bg-gray-200 transition-colors duration-300">{{ num }}</a>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <a href="?{% if query %}keyword={{ query|urlencode }}&{% endif %}{% if selected_cluster %}cluster={{ selected_cluster }}&{% endif %}page={{ page_obj.next_page_number }}"
               class="px-4 py-2 rounded hover:bg-gray-50 transition-colors duration-300 flex items-center">
              ë‹¤ìŒ
              <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </a>
          {% endif %}
        </nav>
      </div>
      {% endif %}
    {% endif %}
  </div>
</div>

<style>
.line-clamp-2{
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}
@keyframes fadeInUp{
  from{opacity:0;transform:translateY(30px);}
  to{opacity:1;transform:translateY(0);}
}
.grid>div{animation:fadeInUp 0.6s ease-out forwards;}
.grid>div:nth-child(2){animation-delay:0.1s;}
.grid>div:nth-child(3){animation-delay:0.2s;}
.grid>div:nth-child(4){animation-delay:0.3s;}
.grid>div:nth-child(5){animation-delay:0.4s;}
.grid>div:nth-child(6){animation-delay:0.5s;}
.hashtag:hover{
  background:#e5e7eb !important;
  color:#374151 !important;
  transform:scale(1.05);
}
html{scroll-behavior:smooth;}
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

<script>
document.addEventListener('DOMContentLoaded',function(){
  /* jQuery UI Autocomplete */
  $("#id_keyword").autocomplete({
    source:"{% url 'history:autocomplete' %}",
    minLength:1,
    delay:200,
    focus:()=>false,
    select:(e,ui)=>{
      $("#id_keyword").val(ui.item.value);
      return false;
    },
    open:function(){
      $('.ui-autocomplete').addClass('shadow-lg border-0 rounded-lg mt-2');
    }
  });

  /* ì¹´ë“œ í˜ì´ë“œì¸ */
  const obsOpt={threshold:0.1,rootMargin:'0px 0px -50px 0px'};
  const fadeObs=new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        e.target.style.opacity='1';
        e.target.style.transform='translateY(0)';
      }
    });
  },obsOpt);
  document.querySelectorAll('.grid > div').forEach((card,i)=>{
    card.style.opacity='0';
    card.style.transform='translateY(30px)';
    card.style.transition=`opacity 0.6s ease ${i*0.1}s, transform 0.6s ease ${i*0.1}s`;
    fadeObs.observe(card);
  });

  /* ì¹´ë“œ ì „ì²´ í´ë¦­ â†’ ìƒì„¸ í˜ì´ì§€ (í•´ì‹œíƒœê·¸Â·ë‚´ë¶€ a ì œì™¸) */
  document.querySelectorAll('.bill-card').forEach(card=>{
    const url=card.dataset.href;
    card.addEventListener('click',e=>{
      if(e.target.closest('a')||e.target.closest('.hashtag')) return;
      window.location.href=url;
    });
  });

  /* í•´ì‹œíƒœê·¸ hover íš¨ê³¼ */
  document.querySelectorAll('.hashtag').forEach(tag=>{
    const bg=tag.style.backgroundColor;
    const co=tag.style.color;
    tag.addEventListener('mouseenter',()=>{
      tag.style.backgroundColor='#f3f4f6';
      tag.style.color='#374151';
      tag.style.transform='scale(1.05)';
    });
    tag.addEventListener('mouseleave',()=>{
      tag.style.backgroundColor=bg;
      tag.style.color=co;
      tag.style.transform='scale(1)';
    });
  });
});
</script>
{% endblock %}
