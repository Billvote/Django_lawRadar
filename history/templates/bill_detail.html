{% extends "base.html" %}
{% block body %}
{% load custom_filters %}
<div class="bg-white min-h-screen">
  <div class="mx-auto max-w-3xl px-4 py-8 sm:px-6 lg:px-8">
    <!-- 헤더 -->
    <div class="mb-8 border-b pb-6">
      <div class="flex items-center space-x-4 mb-2">
        <span class="text-sm font-medium text-gray-900">{{ bill.age.number }}대</span>
        <span class="text-sm text-gray-900">의안번호: {{ bill.bill_number }}</span>
      </div>
      <!-- 제목: 무조건 한줄, 말줄임표 없이 다 보임 -->
      <h1 class="text-3xl font-bold text-gray-900"
          style="white-space:nowrap;overflow:visible;text-overflow:unset;width:auto;max-width:none;">
        {{ bill.title }}
      </h1>
      
      <!-- 클러스터 키워드 해시태그 -->
      <div class="mt-4 flex flex-wrap gap-2">
        {% with cluster_keywords_dict|get_item:bill.cluster as keywords_str %}
          {% if keywords_str %}
            {% with kw_list=keywords_str|split_by_comma %}
              {% for kw in kw_list|slice:":10" %}
                <a href="{% url 'history:cluster_index' bill.cluster %}" class="inline-block">
                  <span class="hashtag inline-block bg-gray-200 text-gray-600 text-sm font-medium px-3 py-1 rounded-full">
                    #{{ kw }}
                  </span>
                </a>
              {% endfor %}
            {% endwith %}
          {% endif %}
        {% endwith %}
      </div>
    </div>

    <!-- 타임라인 -->
    <div class="relative">
      <!-- 세로선 -->
      <div class="absolute left-8 top-0 h-full w-0.5 bg-gray-200 z-0"></div>
      <div class="space-y-12" id="timeline-list">
        {% for related in related_bills %}
        <div id="timeline-{{ related.pk }}" class="relative pl-16 group">
          <!-- 점 -->
          <div class="absolute left-8 top-8 -ml-1.5 h-4 w-4 rounded-full border-4 border-white shadow-lg bg-gray-300 border-gray-100">
          </div>
          <!-- 카드 -->
          <div class="p-6 bg-white border rounded-lg shadow-md transition-shadow hover:shadow-xl max-w-full">
            <div class="flex justify-between items-center">
              <div class="text-base font-semibold text-gray-900 break-words cursor-default"
                   style="word-break:break-all;">
                {{ related.summary|default:"(내용 없음)"|truncatewords:40 }}
              </div>
            </div>
            <div class="mt-2 text-sm text-gray-700 break-all">
              의안번호: {{ related.bill_number }}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<style>
/* 카드 안 글자가 넘치지 않도록 */
.text-base, .text-sm {
  word-break: break-word;
  overflow-wrap: break-word;
}
.group:hover .absolute.h-4.w-4 {
  background-color: #81aaf0;
  transform: scale(1.2);
  transition: all 0.2s ease;
}
/* 제목이 무조건 한줄로 다 보이게 */
h1.text-3xl {
  white-space: nowrap !important;
  overflow: visible !important;
  text-overflow: unset !important;
  width: auto !important;
  max-width: none !important;
  display: block;
}
/* 해시태그 스타일 */
.hashtag {
  cursor: pointer;
  transition: all 0.3s ease;
}
.hashtag:hover {
  background-color: #38bdf8 !important;
  color: white !important;
  transform: scale(1.05);
}
</style>
{% endblock %}

{% block script %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const hashtags = document.querySelectorAll('.hashtag');
    hashtags.forEach(tag => {
      tag.addEventListener('mouseenter', () => {
        tag.style.backgroundColor = '#38bdf8';
        tag.style.color = 'white';
      });
      tag.addEventListener('mouseleave', () => {
        tag.style.backgroundColor = '';
        tag.style.color = '';
      });
    });
  });
</script>
{% endblock %}
